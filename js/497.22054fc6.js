"use strict";(self["webpackChunkbro_app"]=self["webpackChunkbro_app"]||[]).push([[497],{16497:function(t,e,a){a.r(e),a.d(e,{default:function(){return ot}});var s=a(73396),o=a(44870),n=a(87139),i=a(49242),r=a(21030),l=a(16006),c=a(18278),_=a(22483),d=a(21037),p=a(39521),u=a(10996),g=a.n(u),m=a(42325),f=a(15361)["Buffer"];const b={class:"create_passport"},v={class:"cont"},y={class:"back_btn"},k=(0,s._)("svg",{class:"icon"},[(0,s._)("use",{"xlink:href":"/sprite.svg#ic_arrow_hor"})],-1),w={class:"data_wrap"},h={class:"data_hide",id:"completed_passport"},x={class:"data active"},N={class:"avatar"},C={for:"avatar",class:"box hide"},D={key:0,class:"loader_wrap"},z=(0,s._)("div",{class:"loader"},[(0,s._)("span")],-1),S=[z],L={key:1,class:"image"},E=["src"],M=(0,s.uE)('<div class="logo"><img src="'+r+'" alt=""><div class="corner corner_top_left"></div><div class="corner corner_top_right"></div><div class="corner corner_bottom_left"></div><div class="corner corner_bottom_right"></div></div>',1),P={class:"info"},I={class:"line"},q={class:"field"},T={class:"label"},$=["value"],j={class:"field"},A={class:"label"},B={key:0,class:"exp"},O=["readonly"],H=(0,s._)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},[(0,s._)("path",{d:"M9.57716 3.76801L10.5638 2.78134C10.6876 2.65747 10.8347 2.55921 10.9965 2.49217C11.1583 2.42513 11.3317 2.39062 11.5068 2.39062C11.682 2.39062 11.8554 2.42513 12.0172 2.49217C12.179 2.55921 12.326 2.65747 12.4498 2.78134L13.3925 3.72401C13.6425 3.97404 13.7829 4.31312 13.7829 4.66667C13.7829 5.02023 13.6425 5.3593 13.3925 5.60934L12.4058 6.59601M9.57716 3.76801L3.16649 10.178C2.94515 10.3994 2.80874 10.6915 2.78116 11.0033L2.61983 12.83C2.61116 12.9271 2.6239 13.0249 2.65714 13.1166C2.69039 13.2082 2.74333 13.2915 2.81223 13.3604C2.88114 13.4294 2.96433 13.4824 3.05595 13.5158C3.14757 13.5491 3.24538 13.5619 3.34249 13.5533L5.16916 13.392C5.48144 13.3647 5.77413 13.2283 5.99583 13.0067L12.4058 6.59601M9.57716 3.76801L12.4058 6.59601",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round",fill:"none"})],-1),R=[H],F=(0,s._)("svg",{class:"icon"},[(0,s._)("use",{"xlink:href":"/sprite.svg#ic_check"})],-1),G=[F],U=(0,s._)("svg",{class:"icon"},[(0,s._)("use",{"xlink:href":"/sprite.svg#ic_close"})],-1),X=[U],V={class:"line citizenship"},W={class:"field"},Y={class:"label"},J=["innerHTML"],K=(0,s._)("img",{src:l,alt:"",class:"img"},null,-1),Q=(0,s.uE)('<div class="bg_line"><div class="corner corner_top_left"></div><div class="corner corner_top_right"></div><div class="corner corner_bottom_left"></div><div class="corner corner_bottom_right"></div></div><div class="bg_left"></div><div class="bg_right"></div><div class="bg_bottom"></div>',4),Z={key:0,class:"bottom_btns"},tt={key:0,for:"avatar",class:"btn change_image_btn"},et=["href"];var at={__name:"Passport",setup(t){const e=(0,c.s)(),a=(0,s.f3)("i18n"),r=(0,d.lm)(),l=(0,_.tv)(),u=(0,o.iH)(null),z=(0,o.qj)({src:"",buffer:"",status:!1}),H=(0,o.qj)({moonAddress:e.account.moonPassportOwnerAddress,nickName:"",nickNameError:!1,passportImage:"",status:!1,bgGradient:"",showDownloadBtn:!1,editNickname:!1});function F(){let t=event.target.closest(".line").querySelector(".input");H.editNickname=!0,setTimeout((()=>t.focus()))}function U(){H.editNickname=!1,H.nickName=e.account.moonPassportOwner.extension.nickname}function at(){let t=new FormData;if(z.status=!1,u.value.files[0].size/1024/1024<=5){t.append("avatar",u.value.files[0]);let e=new FileReader;e.onload=async()=>{z.buffer=f(e.result),z.src=e.result,z.status=!0},e.readAsDataURL(u.value.files[0])}else r.notify({group:"default",durartion:5e3,title:a.global.t("message.notification_error_file_size_title"),text:a.global.t("message.notification_error_file_size_text",{size:"5mb"}),type:"error"})}async function st(){r.notify({group:"default",duration:-100,title:a.global.t("message.notification_passport_update_process")}),H.status=!0;try{let t=await e.node.add(u.value.files[0]),s=await(0,m.r0)({update_avatar:{new_avatar:t.path,nickname:H.nickName}}),o=await(0,m.pi)(s);0===o.code&&(e.lastTXS=o.transactionHash,r.notify({group:"default",clean:!0}),r.notify({group:e.networks.bostrom.denom,title:a.global.t("message.notification_success_update_passport_title"),type:"success",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}}),z.buffer="",p.hi(document.getElementById("completed_passport"),{quality:1}).then((t=>H.passportImage=t)).catch((t=>console.error(t))),e.getMoonPassport(),e.getOwnerMoonPassport(),e.account.avatar=z.src),o.code&&(r.notify({group:"default",clean:!0}),r.notify({duration:-100,group:e.networks.bostrom.denom,title:a.global.t("message.notification_failed_title"),text:o?.rawLog.toString(),type:"error",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}}))}catch(t){console.log(t),r.notify({group:"default",clean:!0}),r.notify({group:e.networks.bostrom.denom,title:a.global.t("message.notification_failed_title"),text:a.global.t("message.manage_modal_error_rejected"),type:"error",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}})}H.status=!1}function ot(t){let e=/^([a-z0-9-]*)$/g.test(t.target.value);t.target.value.length<8||t.target.value.length>16||!e?H.nickNameError=!0:H.nickNameError=!1}async function nt(){try{let t=await e.jsCyber.queryContractSmart(e.CONTRACT_ADDRESS_PASSPORT,{passport_by_nickname:{nickname:H.nickName}});return t}catch(t){return console.log(t),null}}async function it(){if(H.nickNameError)r.notify({group:"default",clean:!0}),r.notify({durartion:5e3,group:e.networks.bostrom.denom,title:a.global.t("message.passport_error_nickname_title"),text:a.global.t("message.passport_name_exp"),type:"error",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}});else if(null==await nt()){r.notify({group:"default",duration:-100,title:a.global.t("message.notification_passport_update_process")}),H.status=!0,H.editNickname=!1;try{let t=await(0,m.r0)({update_name:{new_nickname:H.nickName,old_nickname:e.account.moonPassportOwner.extension.nickname}}),s=await(0,m.pi)(t);0===s.code&&(e.lastTXS=s.transactionHash,r.notify({group:"default",clean:!0}),r.notify({group:e.networks.bostrom.denom,title:a.global.t("message.notification_success_update_passport_title"),type:"success",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}}),H.bgGradient=g()(H.nickName),p.hi(document.getElementById("completed_passport"),{quality:1}).then((t=>H.passportImage=t)).catch((t=>console.error(t))),await e.getMoonPassport(),await e.getOwnerMoonPassport()),s.code&&(r.notify({group:"default",clean:!0}),r.notify({duration:-100,group:e.networks.bostrom.denom,title:a.global.t("message.notification_failed_title"),text:s?.rawLog.toString(),type:"error",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}}))}catch(t){console.log(t),r.notify({group:"default",clean:!0}),r.notify({group:e.networks.bostrom.denom,title:a.global.t("message.notification_failed_title"),text:a.global.t("message.manage_modal_error_rejected"),type:"error",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}})}H.status=!1}else r.notify({group:"default",durartion:5e3,title:a.global.t("message.notification_error_nickName_title"),text:a.global.t("message.notification_error_nickName_desc"),type:"error"}),H.nickNameError=!0}return(0,s.wF)((()=>{e.tooltip=a.global.t("message.notice_default_account_passport"),H.nickName=e.account.moonPassportOwner.extension.nickname,H.bgGradient=g()(H.nickName)})),(0,s.m0)((()=>{if(e.IPFSStatus){let t=0;e.account.avatar||(t=5100),setTimeout((()=>{z.src=e.account.avatar,z.status=!0,p.hi(document.getElementById("completed_passport"),{quality:1}).then((t=>{H.passportImage=t,H.showDownloadBtn=!0})).catch((t=>console.error(t)))}),t)}})),(t,e)=>{const a=(0,s.up)("router-link");return(0,s.wg)(),(0,s.iD)("section",b,[(0,s._)("div",v,[(0,s._)("div",y,[(0,s.Wm)(a,{to:(0,o.SU)(l).options.history.state.back?(0,o.SU)(l).options.history.state.back:"/account/cosmos",class:"btn"},{default:(0,s.w5)((()=>[k])),_:1},8,["to"])]),(0,s._)("div",w,[(0,s._)("div",h,[(0,s._)("div",x,[(0,s._)("div",N,[(0,s._)("input",{type:"file",id:"avatar",ref_key:"avatar",ref:u,accept:"image/png, image/jpeg",onChange:at},null,544),(0,s._)("label",C,[z.status?((0,s.wg)(),(0,s.iD)("div",L,[(0,s._)("div",null,[(0,s._)("img",{src:z.src,alt:""},null,8,E)])])):((0,s.wg)(),(0,s.iD)("div",D,S))]),M]),(0,s._)("form",P,[(0,s._)("div",I,[(0,s._)("div",q,[(0,s._)("div",T,(0,n.zw)(t.$t("message.passport_address_exp")),1),(0,s._)("input",{type:"text",value:H.moonAddress.slice(0,13)+"..."+H.moonAddress.slice(-6),class:"input",readonly:""},null,8,$)])]),(0,s._)("div",{class:(0,n.C_)(["line",{error:H.nickNameError}])},[(0,s._)("div",j,[(0,s._)("div",A,(0,n.zw)(t.$t("message.passport_name_label")),1),H.editNickname&&!H.status?((0,s.wg)(),(0,s.iD)("div",B,(0,n.zw)(t.$t("message.passport_name_exp")),1)):(0,s.kq)("",!0),(0,s.wy)((0,s._)("input",{class:"input",type:"text",name:"name",maxlength:"16","onUpdate:modelValue":e[0]||(e[0]=t=>H.nickName=t),onInput:ot,readonly:!H.editNickname},null,40,O),[[i.nr,H.nickName]]),H.editNickname||H.status?((0,s.wg)(),(0,s.iD)(s.HY,{key:2},[(0,s._)("button",{type:"submit",class:"submit_btn",onClick:e[2]||(e[2]=(0,i.iM)((t=>it()),["prevent"]))},G),(0,s._)("button",{type:"button",class:"cancel_btn",onClick:e[3]||(e[3]=(0,i.iM)((t=>U()),["prevent"]))},X)],64)):((0,s.wg)(),(0,s.iD)("button",{key:1,type:"button",class:"edit_btn",onClick:e[1]||(e[1]=t=>F())},R))])],2),(0,s._)("div",V,[(0,s._)("div",W,[(0,s._)("div",Y,(0,n.zw)(t.$t("message.passport_citizenship_label")),1),(0,s._)("div",{class:"text",innerHTML:t.$t("message.passport_citizenship_text")},null,8,J),K])])]),Q,(0,s._)("div",{class:"gradient",style:(0,n.j5)({background:H.bgGradient})},null,4)])])]),H.showDownloadBtn?((0,s.wg)(),(0,s.iD)("div",Z,[!z.buffer.length||H.status?((0,s.wg)(),(0,s.iD)("label",tt,(0,n.zw)(t.$t("message.change_image_btn")),1)):((0,s.wg)(),(0,s.iD)("button",{key:1,class:"btn update_btn",onClick:e[4]||(e[4]=(0,i.iM)((t=>st()),["prevent"]))},(0,n.zw)(t.$t("message.update_btn")),1)),(0,s._)("a",{href:H.passportImage,download:"my_passport.png",class:"btn download_btn"},(0,n.zw)(t.$t("message.download_png_btn")),9,et)])):(0,s.kq)("",!0)])])}}};const st=at;var ot=st}}]);
//# sourceMappingURL=497.22054fc6.js.map