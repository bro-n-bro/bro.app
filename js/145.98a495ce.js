"use strict";(self["webpackChunkbro_app"]=self["webpackChunkbro_app"]||[]).push([[145],{96145:function(t,a,e){e.r(a),e.d(a,{default:function(){return Y}});var s=e(73396),o=e(44870),i=e(87139),n=e(49242),l=e(21030),r=e(16006),c=e(18278),d=e(22483),_=e(21037),p=e(39521),u=e(10996),g=e.n(u),m=e(42325),v=e(15361)["Buffer"];const f={class:"create_passport"},b={class:"cont"},w={class:"back_btn"},h=(0,s._)("svg",{class:"icon"},[(0,s._)("use",{"xlink:href":"/sprite.svg#ic_arrow_hor"})],-1),y={class:"data_wrap"},k={class:"data_hide",id:"completed_passport"},S={class:"data active"},x={class:"avatar"},z={for:"avatar",class:"box hide"},U={key:0,class:"loader_wrap"},D=(0,s._)("div",{class:"loader"},[(0,s._)("span")],-1),$=[D],I={key:1,class:"image"},B=["src"],N=(0,s.uE)('<div class="logo"><img src="'+l+'" alt=""><div class="corner corner_top_left"></div><div class="corner corner_top_right"></div><div class="corner corner_bottom_left"></div><div class="corner corner_bottom_right"></div></div>',1),j={class:"info"},q={class:"line"},C={class:"field"},P={class:"label"},A=["value"],E={class:"line"},F={class:"field"},G={class:"label"},M={class:"line citizenship"},H={class:"field"},L={class:"label"},R={class:"text"},T=(0,s._)("img",{src:r,alt:"",class:"img"},null,-1),O=(0,s.uE)('<div class="bg_line"><div class="corner corner_top_left"></div><div class="corner corner_top_right"></div><div class="corner corner_bottom_left"></div><div class="corner corner_bottom_right"></div></div><div class="bg_left"></div><div class="bg_right"></div><div class="bg_bottom"></div>',4),V={key:0,class:"bottom_btns"},W={key:0,for:"avatar",class:"btn change_image_btn"},X=["onClick"],J=["href"];var K={__name:"Passport",setup(t){const a=(0,c.s)(),e=(0,s.f3)("i18n"),l=(0,_.lm)(),r=(0,d.tv)();var u=(0,o.iH)(null),D=(0,o.qj)({src:"",buffer:"",status:!1}),K=(0,o.qj)({moonAddress:a.wallets.bostrom,nickName:"",passportImage:"",status:!1,bgGradient:"",showDownloadBtn:!1});function Q(){let t=new FormData;if(D.status=!1,u.value.files[0].size/1024/1024<=5){t.append("avatar",u.value.files[0]);let a=new FileReader;a.onload=async()=>{D.buffer=v(a.result),D.src=a.result,D.status=!0},a.readAsDataURL(u.value.files[0])}else l.notify({group:"default",durartion:5e3,title:e.global.t("message.notification_error_file_size_title"),text:e.global.t("message.notification_error_file_size_text",{size:"5mb"}),type:"error"})}async function Y(){l.notify({group:"default",duration:-100,title:e.global.t("message.notification_passport_update_process")}),K.status=!0;try{let t=await a.node.add(u.value.files[0]),s=await(0,m.r0)({update_avatar:{new_avatar:t.path,nickname:K.nickName}}),o=await(0,m.pi)(s);0===o.code&&(a.lastTXS=o.transactionHash,l.notify({group:"default",clean:!0}),l.notify({group:a.networks.bostrom.denom,title:e.global.t("message.notification_success_update_passport_title"),type:"success",data:{chain:"bostrom",tx_type:e.global.t("message.notification_action_update_passport")}}),D.buffer="",p.hi(document.getElementById("completed_passport"),{quality:1}).then((t=>K.passportImage=t)).catch((t=>console.error(t))),a.getMoonPassport(),a.getOwnerMoonPassport(),a.account.avatar=D.src),o.code&&(l.notify({group:"default",clean:!0}),l.notify({duration:-100,group:a.networks.bostrom.denom,title:e.global.t("message.notification_failed_title"),text:o?.rawLog.toString(),type:"error",data:{chain:"bostrom",tx_type:e.global.t("message.notification_action_update_passport")}}))}catch(t){console.log(t),l.notify({group:"default",clean:!0}),l.notify({group:a.networks.bostrom.denom,title:e.global.t("message.notification_failed_title"),text:e.global.t("message.manage_modal_error_rejected"),type:"error",data:{chain:"bostrom",tx_type:e.global.t("message.notification_action_update_passport")}})}K.status=!1}return(0,s.bv)((()=>{K.nickName=a.account.owner.moonPassport.extension.nickname,K.bgGradient=g()(K.nickName)})),(0,s.m0)((()=>{if(a.IPFSStatus){let t=0;a.account.avatar||(t=5100),setTimeout((()=>{D.src=a.account.avatar,D.status=!0,p.hi(document.getElementById("completed_passport"),{quality:1}).then((t=>{K.passportImage=t,K.showDownloadBtn=!0})).catch((t=>console.error(t)))}),t)}})),(t,a)=>{const e=(0,s.up)("router-link");return(0,s.wg)(),(0,s.iD)("section",f,[(0,s._)("div",b,[(0,s._)("div",w,[(0,s.Wm)(e,{to:(0,o.SU)(r).options.history.state.back?(0,o.SU)(r).options.history.state.back:"/account/all",class:"btn"},{default:(0,s.w5)((()=>[h,(0,s._)("span",null,(0,i.zw)(t.$t("message.account_btn")),1)])),_:1},8,["to"])]),(0,s._)("div",y,[(0,s._)("div",k,[(0,s._)("div",S,[(0,s._)("div",x,[(0,s._)("input",{type:"file",id:"avatar",ref_key:"avatar",ref:u,accept:"image/png, image/jpeg",onChange:Q},null,544),(0,s._)("label",z,[(0,o.SU)(D).status?((0,s.wg)(),(0,s.iD)("div",I,[(0,s._)("div",null,[(0,s._)("img",{src:(0,o.SU)(D).src,alt:""},null,8,B)])])):((0,s.wg)(),(0,s.iD)("div",U,$))]),N]),(0,s._)("form",j,[(0,s._)("div",q,[(0,s._)("div",C,[(0,s._)("div",P,(0,i.zw)(t.$t("message.passport_address_exp")),1),(0,s._)("input",{type:"text",value:(0,o.SU)(K).moonAddress.slice(0,13)+"..."+(0,o.SU)(K).moonAddress.slice(-6),class:"input",readonly:""},null,8,A)])]),(0,s._)("div",E,[(0,s._)("div",F,[(0,s._)("div",G,(0,i.zw)(t.$t("message.passport_name_label")),1),(0,s.wy)((0,s._)("input",{type:"text",name:"name","onUpdate:modelValue":a[0]||(a[0]=t=>(0,o.SU)(K).nickName=t),class:"input",readonly:""},null,512),[[n.nr,(0,o.SU)(K).nickName]])])]),(0,s._)("div",M,[(0,s._)("div",H,[(0,s._)("div",L,(0,i.zw)(t.$t("message.passport_citizenship_label")),1),(0,s._)("div",R,(0,i.zw)(t.$t("message.passport_citizenship_text")),1),T])])]),O,(0,s._)("div",{class:"gradient",style:(0,i.j5)({background:(0,o.SU)(K).bgGradient})},null,4)])])]),(0,o.SU)(K).showDownloadBtn?((0,s.wg)(),(0,s.iD)("div",V,[!(0,o.SU)(D).buffer.length||(0,o.SU)(K).status?((0,s.wg)(),(0,s.iD)("label",W,(0,i.zw)(t.$t("message.change_image_btn")),1)):((0,s.wg)(),(0,s.iD)("button",{key:1,class:"btn update_btn",onClick:(0,n.iM)(Y,["prevent"])},(0,i.zw)(t.$t("message.update_btn")),9,X)),(0,s._)("a",{href:(0,o.SU)(K).passportImage,download:"my_passport.png",class:"btn download_btn"},(0,i.zw)(t.$t("message.download_png_btn")),9,J)])):(0,s.kq)("",!0)])])}}};const Q=K;var Y=Q}}]);
//# sourceMappingURL=145.98a495ce.js.map