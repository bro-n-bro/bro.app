"use strict";(self["webpackChunkbro_app"]=self["webpackChunkbro_app"]||[]).push([[403],{56403:function(t,e,a){a.r(e),a.d(e,{default:function(){return ct}});var o=a(73396),s=a(44870),n=a(87139),i=a(49242),l=a(27795),r=a(21030),c=a(16006),u=a(87088),_=a(22483),p=a(21037),d=a(39521),g=a(10996),m=a.n(g),v=a(42325),f=a(15941),b=a(15361)["Buffer"];const y=l+"#ic_arrow_hor",w=l+"#ic_check",h=l+"#ic_close",k={class:"create_passport"},x={class:"cont"},C={class:"back_btn"},z=(0,o._)("svg",{class:"icon"},[(0,o._)("use",{"xlink:href":y})],-1),S={class:"data_wrap"},D={class:"data_hide",id:"completed_passport"},H={class:"data active"},L={class:"avatar"},M={for:"avatar",class:"box hide"},P={key:0,class:"loader_wrap"},T=(0,o._)("div",{class:"loader"},[(0,o._)("span")],-1),$=[T],q={key:1,class:"image"},O=["src"],j=(0,o.uE)('<div class="logo"><img src="'+r+'" alt=""><div class="corner corner_top_left"></div><div class="corner corner_top_right"></div><div class="corner corner_bottom_left"></div><div class="corner corner_bottom_right"></div></div>',1),E={class:"info"},N={class:"line"},U={class:"field"},A={class:"label"},B=["value"],I={class:"field"},R={class:"label"},F={key:0,class:"exp"},X=["readonly"],V=(0,o._)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},[(0,o._)("path",{d:"M9.57716 3.76801L10.5638 2.78134C10.6876 2.65747 10.8347 2.55921 10.9965 2.49217C11.1583 2.42513 11.3317 2.39062 11.5068 2.39062C11.682 2.39062 11.8554 2.42513 12.0172 2.49217C12.179 2.55921 12.326 2.65747 12.4498 2.78134L13.3925 3.72401C13.6425 3.97404 13.7829 4.31312 13.7829 4.66667C13.7829 5.02023 13.6425 5.3593 13.3925 5.60934L12.4058 6.59601M9.57716 3.76801L3.16649 10.178C2.94515 10.3994 2.80874 10.6915 2.78116 11.0033L2.61983 12.83C2.61116 12.9271 2.6239 13.0249 2.65714 13.1166C2.69039 13.2082 2.74333 13.2915 2.81223 13.3604C2.88114 13.4294 2.96433 13.4824 3.05595 13.5158C3.14757 13.5491 3.24538 13.5619 3.34249 13.5533L5.16916 13.392C5.48144 13.3647 5.77413 13.2283 5.99583 13.0067L12.4058 6.59601M9.57716 3.76801L12.4058 6.59601",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round",fill:"none"})],-1),W=[V],Y=(0,o._)("svg",{class:"icon"},[(0,o._)("use",{"xlink:href":w})],-1),G=[Y],J=(0,o._)("svg",{class:"icon"},[(0,o._)("use",{"xlink:href":h})],-1),K=[J],Q={class:"line citizenship"},Z={class:"field"},tt={class:"label"},et=["innerHTML"],at=(0,o._)("img",{src:c,alt:"",class:"img"},null,-1),ot=(0,o.uE)('<div class="bg_line"><div class="corner corner_top_left"></div><div class="corner corner_top_right"></div><div class="corner corner_bottom_left"></div><div class="corner corner_bottom_right"></div></div><div class="bg_left"></div><div class="bg_right"></div><div class="bg_bottom"></div>',4),st={key:0,class:"bottom_btns"},nt={key:0,for:"avatar",class:"btn change_image_btn"},it=["href"];var lt={__name:"Passport",setup(t){const e=(0,u.s)(),a=(0,o.f3)("i18n"),l=(0,p.lm)(),r=(0,_.tv)(),c=(0,s.iH)(null),g=(0,s.qj)({src:"",buffer:"",status:!1}),y=e.account.moonPassportOwnerAddress,w=(0,s.iH)(e.account.moonPassportOwner.extension.nickname),h=(0,s.iH)(!1),T=(0,s.iH)(""),V=(0,s.iH)(!1),Y=(0,s.iH)(!1),J=(0,s.iH)(!1),lt=(0,s.iH)("");function rt(){let t=event.target.closest(".line").querySelector(".input");J.value=!0,setTimeout((()=>t.focus()))}function ct(){J.value=!1,w.value=e.account.moonPassportOwner.extension.nickname}function ut(){let t=new FormData;if(g.status=!1,c.value.files[0].size/1024/1024<=5){t.append("avatar",c.value.files[0]);let e=new FileReader;e.onload=async()=>{g.buffer=b(e.result),g.src=e.result,g.status=!0},e.readAsDataURL(c.value.files[0])}else l.notify({group:"default",durartion:5e3,title:a.global.t("message.notification_error_file_size_title"),text:a.global.t("message.notification_error_file_size_text",{size:"5mb"}),type:"error"})}async function _t(){l.notify({group:"default",duration:-100,title:a.global.t("message.notification_passport_update_process")}),V.value=!0;try{let t=await e.node.add(c.value.files[0]),o=await(0,v.r0)({update_avatar:{new_avatar:t.path,nickname:data.nickName}}),s=await(0,v.pi)(o);0===s.code&&(e.lastTXS=s.transactionHash,l.notify({group:"default",clean:!0}),l.notify({group:e.networks.bostrom.denom,title:a.global.t("message.notification_success_update_passport_title"),type:"success",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}}),g.buffer="",d.hi(document.getElementById("completed_passport"),{quality:1}).then((t=>T.value=t)).catch((t=>f.error(t))),await e.getMoonPassport(),await e.getOwnerMoonPassport(),e.account.avatar=g.src),s.code&&(l.notify({group:"default",clean:!0}),l.notify({duration:-100,group:e.networks.bostrom.denom,title:a.global.t("message.notification_failed_title"),text:s?.rawLog.toString(),type:"error",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}}))}catch(t){f.log(t),l.notify({group:"default",clean:!0}),l.notify({group:e.networks.bostrom.denom,title:a.global.t("message.notification_failed_title"),text:a.global.t("message.manage_modal_error_rejected"),type:"error",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}})}data.status=!1}function pt(t){let e=/^([a-z0-9-]*)$/g.test(t.target.value);t.target.value.length<8||t.target.value.length>16||!e?h.value=!0:h.value=!1}async function dt(){try{let t=await e.jsCyber.queryContractSmart(e.CONTRACT_ADDRESS_PASSPORT,{passport_by_nickname:{nickname:w.value}});return t}catch(t){return f.log(t),null}}async function gt(){if(h.value)l.notify({group:"default",clean:!0}),l.notify({durartion:5e3,group:e.networks.bostrom.denom,title:a.global.t("message.passport_error_nickname_title"),text:a.global.t("message.passport_name_exp"),type:"error",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}});else if(null==await dt()){l.notify({group:"default",duration:-100,title:a.global.t("message.notification_passport_update_process")}),V.value=!0,J.value=!1;try{let t=await(0,v.r0)({update_name:{new_nickname:w.value,old_nickname:e.account.moonPassportOwner.extension.nickname}}),o=await(0,v.pi)(t);0===o.code&&(e.lastTXS=o.transactionHash,l.notify({group:"default",clean:!0}),l.notify({group:e.networks.bostrom.denom,title:a.global.t("message.notification_success_update_passport_title"),type:"success",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}}),lt.value=m()(data.nickName),d.hi(document.getElementById("completed_passport"),{quality:1}).then((t=>T.value=t)).catch((t=>f.error(t))),await e.getMoonPassport(),await e.getOwnerMoonPassport()),o.code&&(l.notify({group:"default",clean:!0}),l.notify({duration:-100,group:e.networks.bostrom.denom,title:a.global.t("message.notification_failed_title"),text:o?.rawLog.toString(),type:"error",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}}))}catch(t){f.log(t),l.notify({group:"default",clean:!0}),l.notify({group:e.networks.bostrom.denom,title:a.global.t("message.notification_failed_title"),text:a.global.t("message.manage_modal_error_rejected"),type:"error",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}})}data.status=!1}else l.notify({group:"default",durartion:5e3,title:a.global.t("message.notification_error_nickName_title"),text:a.global.t("message.notification_error_nickName_desc"),type:"error"}),h.value=!0}return(0,o.wF)((()=>{e.tooltip=a.global.t("message.notice_default_account_passport"),lt.value=m()(w.value)})),(0,o.m0)((()=>{if(e.IPFSNode){let t=0;e.account.avatar||(t=5100),setTimeout((()=>{g.src=e.account.avatar,g.status=!0,d.hi(document.getElementById("completed_passport"),{quality:1}).then((t=>{T.value=t,Y.value=!0})).catch((t=>f.error(t)))}),t)}})),(t,e)=>{const a=(0,o.up)("router-link");return(0,o.wg)(),(0,o.iD)("section",k,[(0,o._)("div",x,[(0,o._)("div",C,[(0,o.Wm)(a,{to:(0,s.SU)(r).options.history.state.back?(0,s.SU)(r).options.history.state.back:"/account/cosmoshub",class:"btn"},{default:(0,o.w5)((()=>[z])),_:1},8,["to"])]),(0,o._)("div",S,[(0,o._)("div",D,[(0,o._)("div",H,[(0,o._)("div",L,[(0,o._)("input",{type:"file",id:"avatar",ref_key:"avatar",ref:c,accept:"image/png, image/jpeg",onChange:ut},null,544),(0,o._)("label",M,[g.status?((0,o.wg)(),(0,o.iD)("div",q,[(0,o._)("div",null,[(0,o._)("img",{src:g.src,alt:""},null,8,O)])])):((0,o.wg)(),(0,o.iD)("div",P,$))]),j]),(0,o._)("form",E,[(0,o._)("div",N,[(0,o._)("div",U,[(0,o._)("div",A,(0,n.zw)(t.$t("message.passport_address_exp")),1),(0,o._)("input",{type:"text",value:(0,s.SU)(y).slice(0,13)+"..."+(0,s.SU)(y).slice(-6),class:"input",readonly:""},null,8,B)])]),(0,o._)("div",{class:(0,n.C_)(["line",{error:h.value}])},[(0,o._)("div",I,[(0,o._)("div",R,(0,n.zw)(t.$t("message.passport_name_label")),1),J.value&&!V.value?((0,o.wg)(),(0,o.iD)("div",F,(0,n.zw)(t.$t("message.passport_name_exp")),1)):(0,o.kq)("",!0),(0,o.wy)((0,o._)("input",{class:"input",type:"text",name:"name",maxlength:"16","onUpdate:modelValue":e[0]||(e[0]=t=>w.value=t),onInput:pt,readonly:!J.value},null,40,X),[[i.nr,w.value]]),J.value||V.value?((0,o.wg)(),(0,o.iD)(o.HY,{key:2},[(0,o._)("button",{type:"submit",class:"submit_btn",onClick:e[2]||(e[2]=(0,i.iM)((t=>gt()),["prevent"]))},G),(0,o._)("button",{type:"button",class:"cancel_btn",onClick:e[3]||(e[3]=(0,i.iM)((t=>ct()),["prevent"]))},K)],64)):((0,o.wg)(),(0,o.iD)("button",{key:1,type:"button",class:"edit_btn",onClick:e[1]||(e[1]=t=>rt())},W))])],2),(0,o._)("div",Q,[(0,o._)("div",Z,[(0,o._)("div",tt,(0,n.zw)(t.$t("message.passport_citizenship_label")),1),(0,o._)("div",{class:"text",innerHTML:t.$t("message.passport_citizenship_text")},null,8,et),at])])]),ot,(0,o._)("div",{class:"gradient",style:(0,n.j5)({background:lt.value})},null,4)])])]),Y.value?((0,o.wg)(),(0,o.iD)("div",st,[!g.buffer.length||V.value?((0,o.wg)(),(0,o.iD)("label",nt,(0,n.zw)(t.$t("message.btn_change_image")),1)):((0,o.wg)(),(0,o.iD)("button",{key:1,class:"btn update_btn",onClick:e[4]||(e[4]=(0,i.iM)((t=>_t()),["prevent"]))},(0,n.zw)(t.$t("message.btn_update")),1)),(0,o._)("a",{href:T.value,download:"my_passport.png",class:"btn download_btn"},(0,n.zw)(t.$t("message.btn_download_png")),9,it)])):(0,o.kq)("",!0)])])}}};const rt=lt;var ct=rt}}]);
//# sourceMappingURL=403.d352f8de.js.map