"use strict";(self["webpackChunkbro_app"]=self["webpackChunkbro_app"]||[]).push([[808],{94808:function(t,e,a){a.r(e),a.d(e,{default:function(){return ot}});var o=a(73396),s=a(44870),n=a(87139),i=a(49242),r=a(21030),l=a(16006),c=a(18278),d=a(22483),_=a(21037),p=a(39521),u=a(10996),g=a.n(u),m=a(42325),f=a(15361)["Buffer"];const b={class:"create_passport"},v={class:"cont"},y={class:"back_btn"},k=(0,o._)("svg",{class:"icon"},[(0,o._)("use",{"xlink:href":"/sprite.svg#ic_arrow_hor"})],-1),w={class:"data_wrap"},h={class:"data_hide",id:"completed_passport"},x={class:"data active"},C={class:"avatar"},N={for:"avatar",class:"box hide"},D={key:0,class:"loader_wrap"},S=(0,o._)("div",{class:"loader"},[(0,o._)("span")],-1),z=[S],L={key:1,class:"image"},M=["src"],P=(0,o.uE)('<div class="logo"><img src="'+r+'" alt=""><div class="corner corner_top_left"></div><div class="corner corner_top_right"></div><div class="corner corner_bottom_left"></div><div class="corner corner_bottom_right"></div></div>',1),E={class:"info"},I={class:"line"},T={class:"field"},j={class:"label"},q=["value"],A={class:"field"},B={class:"label"},O=["readonly"],$=(0,o._)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},[(0,o._)("path",{d:"M9.57716 3.76801L10.5638 2.78134C10.6876 2.65747 10.8347 2.55921 10.9965 2.49217C11.1583 2.42513 11.3317 2.39062 11.5068 2.39062C11.682 2.39062 11.8554 2.42513 12.0172 2.49217C12.179 2.55921 12.326 2.65747 12.4498 2.78134L13.3925 3.72401C13.6425 3.97404 13.7829 4.31312 13.7829 4.66667C13.7829 5.02023 13.6425 5.3593 13.3925 5.60934L12.4058 6.59601M9.57716 3.76801L3.16649 10.178C2.94515 10.3994 2.80874 10.6915 2.78116 11.0033L2.61983 12.83C2.61116 12.9271 2.6239 13.0249 2.65714 13.1166C2.69039 13.2082 2.74333 13.2915 2.81223 13.3604C2.88114 13.4294 2.96433 13.4824 3.05595 13.5158C3.14757 13.5491 3.24538 13.5619 3.34249 13.5533L5.16916 13.392C5.48144 13.3647 5.77413 13.2283 5.99583 13.0067L12.4058 6.59601M9.57716 3.76801L12.4058 6.59601",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round",fill:"none"})],-1),H=[$],R=(0,o._)("svg",{class:"icon"},[(0,o._)("use",{"xlink:href":"/sprite.svg#ic_check"})],-1),U=[R],F=(0,o._)("svg",{class:"icon"},[(0,o._)("use",{"xlink:href":"/sprite.svg#ic_close"})],-1),G=[F],X={class:"line citizenship"},V={class:"field"},W={class:"label"},Y=["innerHTML"],J=(0,o._)("img",{src:l,alt:"",class:"img"},null,-1),K=(0,o.uE)('<div class="bg_line"><div class="corner corner_top_left"></div><div class="corner corner_top_right"></div><div class="corner corner_bottom_left"></div><div class="corner corner_bottom_right"></div></div><div class="bg_left"></div><div class="bg_right"></div><div class="bg_bottom"></div>',4),Q={key:0,class:"bottom_btns"},Z={key:0,for:"avatar",class:"btn change_image_btn"},tt=["href"];var et={__name:"Passport",setup(t){const e=(0,c.s)(),a=(0,o.f3)("i18n"),r=(0,_.lm)(),l=(0,d.tv)(),u=(0,s.iH)(null),S=(0,s.qj)({src:"",buffer:"",status:!1}),$=(0,s.qj)({moonAddress:e.account.moonPassportOwnerAddress,nickName:"",nickNameError:!1,passportImage:"",status:!1,bgGradient:"",showDownloadBtn:!1,editNickname:!1});function R(){let t=event.target.closest(".line").querySelector(".input");$.editNickname=!0,setTimeout((()=>t.focus()))}function F(){$.editNickname=!1,$.nickName=e.account.moonPassportOwner.extension.nickname}function et(){let t=new FormData;if(S.status=!1,u.value.files[0].size/1024/1024<=5){t.append("avatar",u.value.files[0]);let e=new FileReader;e.onload=async()=>{S.buffer=f(e.result),S.src=e.result,S.status=!0},e.readAsDataURL(u.value.files[0])}else r.notify({group:"default",durartion:5e3,title:a.global.t("message.notification_error_file_size_title"),text:a.global.t("message.notification_error_file_size_text",{size:"5mb"}),type:"error"})}async function at(){r.notify({group:"default",duration:-100,title:a.global.t("message.notification_passport_update_process")}),$.status=!0;try{let t=await e.node.add(u.value.files[0]),o=await(0,m.r0)({update_avatar:{new_avatar:t.path,nickname:$.nickName}}),s=await(0,m.pi)(o);0===s.code&&(e.lastTXS=s.transactionHash,r.notify({group:"default",clean:!0}),r.notify({group:e.networks.bostrom.denom,title:a.global.t("message.notification_success_update_passport_title"),type:"success",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}}),S.buffer="",p.hi(document.getElementById("completed_passport"),{quality:1}).then((t=>$.passportImage=t)).catch((t=>console.error(t))),e.getMoonPassport(),e.getOwnerMoonPassport(),e.account.avatar=S.src),s.code&&(r.notify({group:"default",clean:!0}),r.notify({duration:-100,group:e.networks.bostrom.denom,title:a.global.t("message.notification_failed_title"),text:s?.rawLog.toString(),type:"error",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}}))}catch(t){console.log(t),r.notify({group:"default",clean:!0}),r.notify({group:e.networks.bostrom.denom,title:a.global.t("message.notification_failed_title"),text:a.global.t("message.manage_modal_error_rejected"),type:"error",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}})}$.status=!1}function ot(t){t.target.value.length<8?$.nickNameError=!0:$.nickNameError=!1,e.account.tempUserName=t.target.value}async function st(){try{let t=await e.jsCyber.queryContractSmart(e.CONTRACT_ADDRESS_PASSPORT,{passport_by_nickname:{nickname:$.nickName}});return t}catch(t){return console.log(t),null}}async function nt(){if(null==await st()){r.notify({group:"default",duration:-100,title:a.global.t("message.notification_passport_update_process")}),$.status=!0,$.editNickname=!1;try{let t=await(0,m.r0)({update_name:{new_nickname:$.nickName,old_nickname:e.account.moonPassportOwner.extension.nickname}}),o=await(0,m.pi)(t);0===o.code&&(e.lastTXS=o.transactionHash,r.notify({group:"default",clean:!0}),r.notify({group:e.networks.bostrom.denom,title:a.global.t("message.notification_success_update_passport_title"),type:"success",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}}),$.bgGradient=g()($.nickName),p.hi(document.getElementById("completed_passport"),{quality:1}).then((t=>$.passportImage=t)).catch((t=>console.error(t))),await e.getMoonPassport(),await e.getOwnerMoonPassport()),o.code&&(r.notify({group:"default",clean:!0}),r.notify({duration:-100,group:e.networks.bostrom.denom,title:a.global.t("message.notification_failed_title"),text:o?.rawLog.toString(),type:"error",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}}))}catch(t){console.log(t),r.notify({group:"default",clean:!0}),r.notify({group:e.networks.bostrom.denom,title:a.global.t("message.notification_failed_title"),text:a.global.t("message.manage_modal_error_rejected"),type:"error",data:{chain:"bostrom",tx_type:a.global.t("message.notification_action_update_passport")}})}$.status=!1}else r.notify({group:"default",durartion:5e3,title:a.global.t("message.notification_error_nickName_title"),text:a.global.t("message.notification_error_nickName_desc"),type:"error"}),$.nickNameError=!0}return(0,o.wF)((()=>{e.tooltip=a.global.t("message.notice_default_account_passport"),$.nickName=e.account.moonPassportOwner.extension.nickname,$.bgGradient=g()($.nickName)})),(0,o.m0)((()=>{if(e.IPFSStatus){let t=0;e.account.avatar||(t=5100),setTimeout((()=>{S.src=e.account.avatar,S.status=!0,p.hi(document.getElementById("completed_passport"),{quality:1}).then((t=>{$.passportImage=t,$.showDownloadBtn=!0})).catch((t=>console.error(t)))}),t)}})),(t,e)=>{const a=(0,o.up)("router-link");return(0,o.wg)(),(0,o.iD)("section",b,[(0,o._)("div",v,[(0,o._)("div",y,[(0,o.Wm)(a,{to:(0,s.SU)(l).options.history.state.back?(0,s.SU)(l).options.history.state.back:"/account/cosmos",class:"btn"},{default:(0,o.w5)((()=>[k])),_:1},8,["to"])]),(0,o._)("div",w,[(0,o._)("div",h,[(0,o._)("div",x,[(0,o._)("div",C,[(0,o._)("input",{type:"file",id:"avatar",ref_key:"avatar",ref:u,accept:"image/png, image/jpeg",onChange:et},null,544),(0,o._)("label",N,[S.status?((0,o.wg)(),(0,o.iD)("div",L,[(0,o._)("div",null,[(0,o._)("img",{src:S.src,alt:""},null,8,M)])])):((0,o.wg)(),(0,o.iD)("div",D,z))]),P]),(0,o._)("form",E,[(0,o._)("div",I,[(0,o._)("div",T,[(0,o._)("div",j,(0,n.zw)(t.$t("message.passport_address_exp")),1),(0,o._)("input",{type:"text",value:$.moonAddress.slice(0,13)+"..."+$.moonAddress.slice(-6),class:"input",readonly:""},null,8,q)])]),(0,o._)("div",{class:(0,n.C_)(["line",{error:$.nickNameError}])},[(0,o._)("div",A,[(0,o._)("div",B,(0,n.zw)(t.$t("message.passport_name_label")),1),(0,o.wy)((0,o._)("input",{class:"input",type:"text",name:"name",maxlength:"16","onUpdate:modelValue":e[0]||(e[0]=t=>$.nickName=t),onInput:ot,readonly:!$.editNickname},null,40,O),[[i.nr,$.nickName]]),$.editNickname||$.status?((0,o.wg)(),(0,o.iD)(o.HY,{key:1},[(0,o._)("button",{type:"submit",class:"submit_btn",onClick:e[2]||(e[2]=(0,i.iM)((t=>nt()),["prevent"]))},U),(0,o._)("button",{type:"button",class:"cancel_btn",onClick:e[3]||(e[3]=(0,i.iM)((t=>F()),["prevent"]))},G)],64)):((0,o.wg)(),(0,o.iD)("button",{key:0,type:"button",class:"edit_btn",onClick:e[1]||(e[1]=t=>R())},H))])],2),(0,o._)("div",X,[(0,o._)("div",V,[(0,o._)("div",W,(0,n.zw)(t.$t("message.passport_citizenship_label")),1),(0,o._)("div",{class:"text",innerHTML:t.$t("message.passport_citizenship_text")},null,8,Y),J])])]),K,(0,o._)("div",{class:"gradient",style:(0,n.j5)({background:$.bgGradient})},null,4)])])]),$.showDownloadBtn?((0,o.wg)(),(0,o.iD)("div",Q,[!S.buffer.length||$.status?((0,o.wg)(),(0,o.iD)("label",Z,(0,n.zw)(t.$t("message.change_image_btn")),1)):((0,o.wg)(),(0,o.iD)("button",{key:1,class:"btn update_btn",onClick:e[4]||(e[4]=(0,i.iM)((t=>at()),["prevent"]))},(0,n.zw)(t.$t("message.update_btn")),1)),(0,o._)("a",{href:$.passportImage,download:"my_passport.png",class:"btn download_btn"},(0,n.zw)(t.$t("message.download_png_btn")),9,tt)])):(0,o.kq)("",!0)])])}}};const at=et;var ot=at}}]);
//# sourceMappingURL=808.a0bc779d.js.map